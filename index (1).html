<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ì½” ì¶œì„ì²´í¬</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        /* ëª¨ë°”ì¼ ìµœì í™” */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        /* ëª¨ë°”ì¼ í—¤ë” */
        @media (max-width: 768px) {
            .header {
                padding: 20px 15px;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            .header p {
                font-size: 12px;
            }
        }

        .content {
            padding: 30px;
        }

        /* ëª¨ë°”ì¼ ì½˜í…ì¸  */
        @media (max-width: 768px) {
            .content {
                padding: 15px;
            }
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 20px;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        /* ëª¨ë°”ì¼ ì„¹ì…˜ íƒ€ì´í‹€ */
        @media (max-width: 768px) {
            .section-title {
                font-size: 18px;
            }
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        input[type="text"],
        input[type="date"] {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
            min-width: 0; /* ëª¨ë°”ì¼ ì˜¤ë²„í”Œë¡œìš° ë°©ì§€ */
        }

        input[type="text"]:focus,
        input[type="date"]:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            padding: 12px 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            white-space: nowrap; /* ë²„íŠ¼ í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ ë°©ì§€ */
        }

        /* ëª¨ë°”ì¼ ì…ë ¥ í•„ë“œ ë° ë²„íŠ¼ */
        @media (max-width: 768px) {
            input[type="text"],
            input[type="date"] {
                font-size: 14px;
                padding: 10px 12px;
            }
            
            button {
                font-size: 14px;
                padding: 10px 20px;
            }
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .members-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        /* ëª¨ë°”ì¼ íšŒì› ê·¸ë¦¬ë“œ */
        @media (max-width: 768px) {
            .members-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 10px;
            }
        }

        @media (max-width: 480px) {
            .members-grid {
                grid-template-columns: 1fr 1fr;
                gap: 8px;
            }
        }

        .member-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .member-card:hover {
            background: #e9ecef;
        }

        .member-card.checked {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .member-name {
            font-weight: 600;
            font-size: 16px;
            word-break: keep-all; /* ì´ë¦„ ì¤„ë°”ê¿ˆ ë°©ì§€ */
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* ëª¨ë°”ì¼ íšŒì› ì¹´ë“œ */
        @media (max-width: 768px) {
            .member-card {
                padding: 12px;
            }
            
            .member-name {
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .member-card {
                padding: 10px;
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .member-name {
                font-size: 13px;
            }
        }

        .check-button {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: white;
            border: 2px solid #667eea;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s;
        }

        .member-card.checked .check-button {
            background: white;
            color: #667eea;
        }

        .delete-member {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
            margin-left: 10px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        /* ëª¨ë°”ì¼ í†µê³„ */
        @media (max-width: 768px) {
            .stats {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }
            
            .stat-card {
                padding: 15px 10px;
            }
            
            .stat-value {
                font-size: 24px;
            }
            
            .stat-label {
                font-size: 12px;
            }
        }

        @media (max-width: 480px) {
            .stat-value {
                font-size: 20px;
            }
            
            .stat-label {
                font-size: 11px;
            }
        }

        .history-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .history-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .history-date {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .history-members {
            font-size: 14px;
            color: #666;
        }

        .clear-button {
            background: #dc3545;
            margin-left: 10px;
        }

        .export-button {
            background: #28a745;
            margin-left: 10px;
        }

        .admin-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 20px;
            border-radius: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s;
            font-size: 14px;
        }

        /* ëª¨ë°”ì¼ ê´€ë¦¬ì í† ê¸€ */
        @media (max-width: 768px) {
            .admin-toggle {
                top: 10px;
                right: 10px;
                font-size: 12px;
                padding: 8px 15px;
            }
        }

        .admin-toggle:hover {
            background: white;
            box-shadow: 0 6px 16px rgba(0,0,0,0.3);
        }

        .admin-mode {
            background: #dc3545 !important;
            color: white !important;
        }

        .delete-member {
            display: none;
        }

        .admin-active .delete-member {
            display: inline-block;
        }

        .admin-only {
            display: none;
        }

        .admin-active .admin-only {
            display: block;
        }

        .quick-check-section {
            background: #f0f4ff;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #667eea;
        }

        /* ëª¨ë°”ì¼ ë¹ ë¥¸ ì²´í¬ */
        @media (max-width: 768px) {
            .quick-check-section {
                padding: 15px;
                margin: 15px 0;
            }
            
            .quick-check-section h3 {
                font-size: 14px !important;
            }
        }

        .search-filter {
            margin: 20px 0;
        }

        .search-filter input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
        }

        .search-filter input:focus {
            outline: none;
            border-color: #667eea;
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .filter-btn {
            flex: 1;
            padding: 10px 15px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        /* ëª¨ë°”ì¼ í•„í„° ë²„íŠ¼ */
        @media (max-width: 768px) {
            .filter-buttons {
                gap: 5px;
            }
            
            .filter-btn {
                padding: 8px 10px;
                font-size: 12px;
            }
        }

        @media (max-width: 480px) {
            .filter-btn {
                padding: 8px 5px;
                font-size: 11px;
            }
        }

        .filter-btn:hover {
            border-color: #667eea;
        }

        .filter-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .filter-btn span {
            font-weight: bold;
            margin-left: 5px;
        }

        .search-suggestions {
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
            background: white;
            border-radius: 8px;
        }

        .suggestion-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-item:hover {
            background: #f8f9fa;
        }

        .suggestion-item.checked {
            background: #e7f3e7;
        }

        .suggestion-name {
            font-weight: 500;
        }

        .suggestion-status {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 4px;
            background: #dc3545;
            color: white;
        }

        .suggestion-status.checked {
            background: #28a745;
        }

        .member-card.hidden {
            display: none;
        }

        .highlight {
            background-color: yellow;
            font-weight: bold;
        }

        .toast {
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 40px;
            border-radius: 50px;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.5);
            font-size: 18px;
            font-weight: bold;
            z-index: 3000;
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            display: flex;
            align-items: center;
            gap: 15px;
            max-width: 90%;
        }

        /* ëª¨ë°”ì¼ í† ìŠ¤íŠ¸ */
        @media (max-width: 768px) {
            .toast {
                top: 80px;
                padding: 15px 25px;
                font-size: 14px;
                gap: 10px;
                border-radius: 30px;
            }
            
            .toast-icon {
                font-size: 24px !important;
            }
        }

        @media (max-width: 480px) {
            .toast {
                top: 70px;
                padding: 12px 20px;
                font-size: 13px;
            }
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .toast-icon {
            font-size: 32px;
            animation: bounce 0.6s ease;
        }

        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .toast.success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            box-shadow: 0 10px 40px rgba(40, 167, 69, 0.5);
        }

        .toast.error {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            box-shadow: 0 10px 40px rgba(220, 53, 69, 0.5);
        }

        .save-button-wrapper {
            position: relative;
            display: inline-block;
        }

        .save-success-effect {
            animation: saveSuccess 0.6s ease;
        }

        @keyframes saveSuccess {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); box-shadow: 0 10px 30px rgba(40, 167, 69, 0.6); }
            100% { transform: scale(1); }
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #667eea;
            position: absolute;
            animation: confetti-fall 1s ease-out forwards;
        }

        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .modal-content h3 {
            margin-bottom: 20px;
            color: #333;
        }

        /* ëª¨ë°”ì¼ ëª¨ë‹¬ */
        @media (max-width: 768px) {
            .modal-content {
                padding: 20px;
                width: 85%;
            }
            
            .modal-content h3 {
                font-size: 18px;
                margin-bottom: 15px;
            }
        }

        .modal-content input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-buttons button {
            flex: 1;
        }

        .cancel-button {
            background: #6c757d;
        }

        .excel-button {
            background: #28a745;
        }

        @media (max-width: 768px) {
            .members-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }

            .input-group {
                flex-direction: column;
            }

            .admin-toggle {
                top: 10px;
                right: 10px;
                font-size: 14px;
                padding: 8px 15px;
            }
        }
    </style>
</head>
<body>
    <!-- í† ìŠ¤íŠ¸ ë©”ì‹œì§€ -->
    <div id="toast" class="toast">
        <span class="toast-icon"></span>
        <span class="toast-message"></span>
    </div>

    <!-- ê´€ë¦¬ì ëª¨ë“œ í† ê¸€ -->
    <div class="admin-toggle" id="adminToggle" onclick="toggleAdminMode()">
        ğŸ”’ ê´€ë¦¬ì ëª¨ë“œ
    </div>

    <!-- ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ëª¨ë‹¬ -->
    <div class="modal" id="passwordModal">
        <div class="modal-content">
            <h3>ğŸ” ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸</h3>
            <input type="password" id="passwordInput" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            <div class="modal-buttons">
                <button class="cancel-button" onclick="closePasswordModal()">ì·¨ì†Œ</button>
                <button onclick="checkPassword()">í™•ì¸</button>
            </div>
        </div>
    </div>

    <div class="container" id="mainContainer">
        <div class="header">
            <h1>ğŸ¯ ë§ì½” ì¶œì„ì²´í¬</h1>
            <p>íšŒì› ì¶œì„ì„ ì²´í¬í•˜ê³  ê´€ë¦¬í•˜ì„¸ìš”</p>
        </div>

        <div class="content">
            <!-- íšŒì› ì¶”ê°€ ì„¹ì…˜ -->
            <div class="section admin-only">
                <h2 class="section-title">íšŒì› ì¶”ê°€</h2>
                <div class="input-group">
                    <input type="text" id="memberNameInput" placeholder="íšŒì› ì´ë¦„ ì…ë ¥">
                    <button onclick="addMember()">íšŒì› ì¶”ê°€</button>
                </div>
            </div>

            <!-- ì¶œì„ ì²´í¬ ì„¹ì…˜ -->
            <div class="section">
                <h2 class="section-title">ì˜¤ëŠ˜ ì¶œì„ ì²´í¬</h2>
                <div class="input-group">
                    <input type="date" id="attendanceDate">
                    <button class="clear-button" onclick="clearToday()">ì´ˆê¸°í™”</button>
                </div>
                <p style="text-align: center; color: #667eea; font-size: 14px; margin: 10px 0;">
                    ğŸ’¾ ì¶œì„ ì²´í¬ ì‹œ ìë™ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤
                </p>
                
                <!-- ë¹ ë¥¸ ì¶œì„ ì²´í¬ -->
                <div class="quick-check-section">
                    <h3 style="font-size: 16px; margin-bottom: 10px; color: #667eea;">âš¡ ë¹ ë¥¸ ì¶œì„ ì²´í¬</h3>
                    <div class="input-group">
                        <input type="text" id="quickCheckInput" placeholder="ì´ë¦„ ì…ë ¥ í›„ Enter (ì˜ˆ: í™ê¸¸ë™)" autocomplete="off">
                        <button onclick="quickCheck()">ì¶œì„ ì²´í¬</button>
                    </div>
                    <div id="searchSuggestions" class="search-suggestions"></div>
                </div>

                <!-- ê²€ìƒ‰ í•„í„° -->
                <div class="search-filter">
                    <input type="text" id="searchInput" placeholder="ğŸ” íšŒì› ê²€ìƒ‰..." autocomplete="off">
                    <div class="filter-buttons">
                        <button class="filter-btn active" onclick="filterMembers('all')">ì „ì²´ <span id="countAll">0</span></button>
                        <button class="filter-btn" onclick="filterMembers('checked')">ì¶œì„ <span id="countChecked">0</span></button>
                        <button class="filter-btn" onclick="filterMembers('unchecked')">ë¯¸ì¶œì„ <span id="countUnchecked">0</span></button>
                    </div>
                </div>

                <div class="members-grid" id="membersGrid"></div>
            </div>

            <!-- í†µê³„ ì„¹ì…˜ -->
            <div class="section">
                <h2 class="section-title">ì¶œì„ í†µê³„</h2>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value" id="totalMembers">0</div>
                        <div class="stat-label">ì „ì²´ íšŒì›</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="todayAttendance">0</div>
                        <div class="stat-label">ì˜¤ëŠ˜ ì¶œì„</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="attendanceRate">0%</div>
                        <div class="stat-label">ì¶œì„ë¥ </div>
                    </div>
                </div>
            </div>

            <!-- ì¶œì„ ê¸°ë¡ ì„¹ì…˜ -->
            <div class="section">
                <h2 class="section-title">ì¶œì„ ê¸°ë¡</h2>
                <button class="excel-button admin-only" onclick="exportToExcel()">ğŸ“Š ì—‘ì…€ë¡œ ë‚´ë³´ë‚´ê¸°</button>
                <div class="history-list" id="historyList"></div>
            </div>
        </div>
    </div>

    <script>
        // ë°ì´í„° ì €ì¥ì†Œ
        let members = JSON.parse(localStorage.getItem('members')) || [];
        let attendanceHistory = JSON.parse(localStorage.getItem('attendanceHistory')) || [];
        let todayAttendance = new Set();
        let isAdminMode = false;
        const ADMIN_PASSWORD = localStorage.getItem('adminPassword') || '0227'; // ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸
        let currentFilter = 'all'; // í˜„ì¬ í•„í„° ìƒíƒœ

        // í˜ì´ì§€ ë¡œë“œì‹œ ì´ˆê¸°í™”
        window.onload = function() {
            document.getElementById('attendanceDate').valueAsDate = new Date();
            loadAttendanceForDate(); // ì˜¤ëŠ˜ ë‚ ì§œì˜ ì¶œì„ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
            renderMembers();
            updateStats();
            renderHistory();
            updateFilterCounts();
            setupSearchListeners();
            
            // ë‚ ì§œ ë³€ê²½ ì‹œ í•´ë‹¹ ë‚ ì§œì˜ ì¶œì„ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
            document.getElementById('attendanceDate').addEventListener('change', function() {
                loadAttendanceForDate();
            });
        };

        // ì„ íƒëœ ë‚ ì§œì˜ ì¶œì„ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadAttendanceForDate() {
            const selectedDate = document.getElementById('attendanceDate').value;
            const record = attendanceHistory.find(h => h.date === selectedDate);
            
            todayAttendance.clear();
            
            if (record) {
                record.members.forEach(member => {
                    todayAttendance.add(member);
                });
            }
            
            renderMembers();
            updateStats();
            updateFilterCounts();
        }

        // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
        function showToast(message, type = 'success', icon = 'âœ“') {
            const toast = document.getElementById('toast');
            const toastIcon = toast.querySelector('.toast-icon');
            const toastMessage = toast.querySelector('.toast-message');
            
            toastIcon.textContent = icon;
            toastMessage.textContent = message;
            
            // íƒ€ì…ì— ë”°ë¼ í´ë˜ìŠ¤ ë³€ê²½
            toast.className = 'toast';
            if (type === 'success') {
                toast.classList.add('success');
            } else if (type === 'error') {
                toast.classList.add('error');
            }
            
            // í† ìŠ¤íŠ¸ í‘œì‹œ
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            // 3ì´ˆ í›„ ìˆ¨ê¹€
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // ì»¨í˜í‹° íš¨ê³¼
        function createConfetti() {
            const colors = ['#667eea', '#764ba2', '#28a745', '#ffc107', '#dc3545', '#17a2b8'];
            const confettiCount = 50;
            
            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 0.3 + 's';
                confetti.style.animationDuration = (Math.random() * 0.5 + 0.5) + 's';
                
                document.body.appendChild(confetti);
                
                // ì• ë‹ˆë©”ì´ì…˜ ì¢…ë£Œ í›„ ì œê±°
                setTimeout(() => {
                    confetti.remove();
                }, 1500);
            }
        }

        // ë²„íŠ¼ ì„±ê³µ íš¨ê³¼
        function buttonSuccessEffect() {
            const saveButton = document.getElementById('saveButton');
            saveButton.classList.add('save-success-effect');
            
            setTimeout(() => {
                saveButton.classList.remove('save-success-effect');
            }, 600);
        }

        // ê²€ìƒ‰ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupSearchListeners() {
            const searchInput = document.getElementById('searchInput');
            const quickCheckInput = document.getElementById('quickCheckInput');

            searchInput.addEventListener('input', function() {
                filterAndSearchMembers();
            });

            quickCheckInput.addEventListener('input', function() {
                showSearchSuggestions(this.value);
            });

            quickCheckInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    quickCheck();
                }
            });
        }

        // ë¹ ë¥¸ ì¶œì„ ì²´í¬
        function quickCheck() {
            const input = document.getElementById('quickCheckInput');
            const name = input.value.trim();

            if (name === '') {
                showToast('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error', 'âš ï¸');
                return;
            }

            const foundMember = members.find(m => m.toLowerCase() === name.toLowerCase());

            if (!foundMember) {
                showToast('ë“±ë¡ë˜ì§€ ì•Šì€ íšŒì›ì…ë‹ˆë‹¤.', 'error', 'âŒ');
                return;
            }

            if (todayAttendance.has(foundMember)) {
                todayAttendance.delete(foundMember);
                showToast(`${foundMember}ë‹˜ ì¶œì„ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'error', 'â†©ï¸');
            } else {
                todayAttendance.add(foundMember);
                showToast(`${foundMember}ë‹˜ ì¶œì„ ì™„ë£Œ!`, 'success', 'âœ“');
            }

            input.value = '';
            document.getElementById('searchSuggestions').innerHTML = '';
            renderMembers();
            updateStats();
            updateFilterCounts();
            
            // ìë™ ì €ì¥
            autoSaveAttendance();
        }

        // ê²€ìƒ‰ ìë™ì™„ì„± í‘œì‹œ
        function showSearchSuggestions(query) {
            const suggestionsDiv = document.getElementById('searchSuggestions');
            
            if (query.trim() === '') {
                suggestionsDiv.innerHTML = '';
                return;
            }

            const filtered = members.filter(m => 
                m.toLowerCase().includes(query.toLowerCase())
            );

            if (filtered.length === 0) {
                suggestionsDiv.innerHTML = '<div style="padding: 15px; text-align: center; color: #999;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            suggestionsDiv.innerHTML = filtered.map(member => {
                const isChecked = todayAttendance.has(member);
                const highlightedName = member.replace(
                    new RegExp(query, 'gi'), 
                    match => `<span class="highlight">${match}</span>`
                );
                
                return `
                    <div class="suggestion-item ${isChecked ? 'checked' : ''}" onclick="selectSuggestion('${member}')">
                        <span class="suggestion-name">${highlightedName}</span>
                        <span class="suggestion-status ${isChecked ? 'checked' : ''}">${isChecked ? 'âœ“ ì¶œì„' : 'ë¯¸ì¶œì„'}</span>
                    </div>
                `;
            }).join('');
        }

        // ìë™ì™„ì„± í•­ëª© ì„ íƒ
        function selectSuggestion(name) {
            document.getElementById('quickCheckInput').value = name;
            document.getElementById('searchSuggestions').innerHTML = '';
            quickCheck();
        }

        // í•„í„° ë³€ê²½
        function filterMembers(filter) {
            currentFilter = filter;
            
            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            filterAndSearchMembers();
        }

        // í•„í„°ì™€ ê²€ìƒ‰ ë™ì‹œ ì ìš©
        function filterAndSearchMembers() {
            const searchQuery = document.getElementById('searchInput').value.toLowerCase();
            const cards = document.querySelectorAll('.member-card');

            cards.forEach(card => {
                const name = card.querySelector('.member-name').textContent.toLowerCase();
                const isChecked = card.classList.contains('checked');

                // ê²€ìƒ‰ í•„í„°
                const matchesSearch = name.includes(searchQuery);

                // ìƒíƒœ í•„í„°
                let matchesFilter = true;
                if (currentFilter === 'checked') {
                    matchesFilter = isChecked;
                } else if (currentFilter === 'unchecked') {
                    matchesFilter = !isChecked;
                }

                // ë‘˜ ë‹¤ ë§Œì¡±í•˜ë©´ í‘œì‹œ
                if (matchesSearch && matchesFilter) {
                    card.classList.remove('hidden');
                } else {
                    card.classList.add('hidden');
                }
            });
        }

        // í•„í„° ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
        function updateFilterCounts() {
            const total = members.length;
            const checked = todayAttendance.size;
            const unchecked = total - checked;

            document.getElementById('countAll').textContent = total;
            document.getElementById('countChecked').textContent = checked;
            document.getElementById('countUnchecked').textContent = unchecked;
        }

        // ê´€ë¦¬ì ëª¨ë“œ í† ê¸€
        function toggleAdminMode() {
            if (!isAdminMode) {
                document.getElementById('passwordModal').classList.add('show');
            } else {
                isAdminMode = false;
                document.getElementById('mainContainer').classList.remove('admin-active');
                document.getElementById('adminToggle').textContent = 'ğŸ”’ ê´€ë¦¬ì ëª¨ë“œ';
                document.getElementById('adminToggle').classList.remove('admin-mode');
            }
        }

        // ë¹„ë°€ë²ˆí˜¸ ëª¨ë‹¬ ë‹«ê¸°
        function closePasswordModal() {
            document.getElementById('passwordModal').classList.remove('show');
            document.getElementById('passwordInput').value = '';
        }

        // ë¹„ë°€ë²ˆí˜¸ í™•ì¸
        function checkPassword() {
            const inputPassword = document.getElementById('passwordInput').value;
            
            if (inputPassword === ADMIN_PASSWORD) {
                isAdminMode = true;
                document.getElementById('mainContainer').classList.add('admin-active');
                document.getElementById('adminToggle').textContent = 'ğŸ”“ ì¼ë°˜ ëª¨ë“œ';
                document.getElementById('adminToggle').classList.add('admin-mode');
                closePasswordModal();
                alert('ê´€ë¦¬ì ëª¨ë“œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } else {
                alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
            }
        }

        // Enter í‚¤ë¡œ ë¹„ë°€ë²ˆí˜¸ í™•ì¸
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('passwordInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkPassword();
                }
            });
        });

        // íšŒì› ì¶”ê°€
        function addMember() {
            if (!isAdminMode) {
                alert('ê´€ë¦¬ì ëª¨ë“œì—ì„œë§Œ íšŒì›ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }

            const input = document.getElementById('memberNameInput');
            const name = input.value.trim();
            
            if (name === '') {
                alert('íšŒì› ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (members.includes(name)) {
                alert('ì´ë¯¸ ë“±ë¡ëœ íšŒì›ì…ë‹ˆë‹¤.');
                return;
            }

            members.push(name);
            localStorage.setItem('members', JSON.stringify(members));
            input.value = '';
            renderMembers();
            updateStats();
        }

        // íšŒì› ì‚­ì œ
        function deleteMember(name) {
            if (!isAdminMode) {
                alert('ê´€ë¦¬ì ëª¨ë“œì—ì„œë§Œ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }

            if (confirm(`${name} íšŒì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                members = members.filter(m => m !== name);
                localStorage.setItem('members', JSON.stringify(members));
                todayAttendance.delete(name);
                renderMembers();
                updateStats();
            }
        }

        // ì¶œì„ í† ê¸€
        function toggleAttendance(name) {
            if (todayAttendance.has(name)) {
                todayAttendance.delete(name);
            } else {
                todayAttendance.add(name);
            }
            renderMembers();
            updateStats();
            
            // ìë™ ì €ì¥
            autoSaveAttendance();
        }

        // íšŒì› ëª©ë¡ ë Œë”ë§
        function renderMembers() {
            const grid = document.getElementById('membersGrid');
            grid.innerHTML = '';

            // íšŒì›ì„ ì´ë¦„ìˆœìœ¼ë¡œ ì •ë ¬
            const sortedMembers = [...members].sort((a, b) => a.localeCompare(b, 'ko'));

            sortedMembers.forEach(member => {
                const card = document.createElement('div');
                card.className = 'member-card' + (todayAttendance.has(member) ? ' checked' : '');
                
                card.innerHTML = `
                    <span class="member-name">${member}</span>
                    <div>
                        <button class="check-button" onclick="toggleAttendance('${member}')">
                            ${todayAttendance.has(member) ? 'âœ“' : ''}
                        </button>
                        <button class="delete-member" onclick="deleteMember('${member}')">Ã—</button>
                    </div>
                `;
                
                grid.appendChild(card);
            });

            // ë Œë”ë§ í›„ í•„í„° ì ìš©
            filterAndSearchMembers();
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            document.getElementById('totalMembers').textContent = members.length;
            document.getElementById('todayAttendance').textContent = todayAttendance.size;
            
            const rate = members.length > 0 
                ? Math.round((todayAttendance.size / members.length) * 100) 
                : 0;
            document.getElementById('attendanceRate').textContent = rate + '%';
            
            updateFilterCounts();
        }

        // ìë™ ì €ì¥ í•¨ìˆ˜
        function autoSaveAttendance() {
            // ì¶œì„ ì²´í¬ê°€ ì—†ìœ¼ë©´ ì €ì¥í•˜ì§€ ì•ŠìŒ
            if (todayAttendance.size === 0) {
                // ì¶œì„ì´ ëª¨ë‘ ì·¨ì†Œëœ ê²½ìš°, í•´ë‹¹ ë‚ ì§œ ê¸°ë¡ ì‚­ì œ
                const date = document.getElementById('attendanceDate').value;
                attendanceHistory = attendanceHistory.filter(h => h.date !== date);
                localStorage.setItem('attendanceHistory', JSON.stringify(attendanceHistory));
                renderHistory();
                return;
            }

            const date = document.getElementById('attendanceDate').value;
            const attendanceRecord = {
                date: date,
                members: Array.from(todayAttendance),
                total: members.length
            };

            // ê°™ì€ ë‚ ì§œê°€ ìˆìœ¼ë©´ ë®ì–´ì“°ê¸°
            attendanceHistory = attendanceHistory.filter(h => h.date !== date);
            attendanceHistory.unshift(attendanceRecord);
            
            localStorage.setItem('attendanceHistory', JSON.stringify(attendanceHistory));
            renderHistory();
        }

        // ì¶œì„ ì €ì¥ (ìˆ˜ë™ ì €ì¥ - ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•Šì§€ë§Œ í˜¸í™˜ì„±ì„ ìœ„í•´ ìœ ì§€)
        function saveAttendance() {
            if (todayAttendance.size === 0) {
                showToast('ì¶œì„ ì²´í¬ëœ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.', 'error', 'âš ï¸');
                return;
            }

            const date = document.getElementById('attendanceDate').value;
            const attendanceRecord = {
                date: date,
                members: Array.from(todayAttendance),
                total: members.length
            };

            // ê°™ì€ ë‚ ì§œê°€ ìˆìœ¼ë©´ ë®ì–´ì“°ê¸°
            attendanceHistory = attendanceHistory.filter(h => h.date !== date);
            attendanceHistory.unshift(attendanceRecord);
            
            localStorage.setItem('attendanceHistory', JSON.stringify(attendanceHistory));
            
            // ì„±ê³µ íš¨ê³¼ë“¤ ì‹¤í–‰
            buttonSuccessEffect();
            createConfetti();
            showToast(`${date} ì¶œì„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! (${todayAttendance.size}ëª…)`, 'success', 'ğŸ‰');
            
            renderHistory();
        }

        // ì˜¤ëŠ˜ ì¶œì„ ì´ˆê¸°í™”
        function clearToday() {
            if (confirm('ì˜¤ëŠ˜ ì¶œì„ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                todayAttendance.clear();
                renderMembers();
                updateStats();
                
                // ìë™ ì €ì¥ (ì¶œì„ ê¸°ë¡ ì‚­ì œ)
                autoSaveAttendance();
                
                showToast('ì¶œì„ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success', 'ğŸ”„');
            }
        }

        // ì¶œì„ ê¸°ë¡ ë Œë”ë§
        function renderHistory() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';

            if (attendanceHistory.length === 0) {
                historyList.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">ì¶œì„ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            attendanceHistory.forEach(record => {
                const item = document.createElement('div');
                item.className = 'history-item';
                
                const rate = Math.round((record.members.length / record.total) * 100);
                
                item.innerHTML = `
                    <div class="history-date">${record.date} - ${record.members.length}/${record.total}ëª… (${rate}%)</div>
                    <div class="history-members">${record.members.join(', ')}</div>
                `;
                
                historyList.appendChild(item);
            });
        }

        // ì—‘ì…€ë¡œ ë‚´ë³´ë‚´ê¸°
        function exportToExcel() {
            // ê´€ë¦¬ì ê¶Œí•œ ì²´í¬
            if (!isAdminMode) {
                showToast('ê´€ë¦¬ì ëª¨ë“œì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'error', 'ğŸ”’');
                return;
            }

            if (attendanceHistory.length === 0) {
                showToast('ì¶œì„ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.', 'error', 'âš ï¸');
                return;
            }

            // ì›Œí¬ë¶ ìƒì„±
            const wb = XLSX.utils.book_new();

            // 1. ë‚ ì§œë³„ ì¶œì„ í˜„í™© ì‹œíŠ¸ (ì°¸ê°€ìë³„ í–‰ ë¶„ë¦¬)
            const attendanceData = [
                ['ë‚ ì§œ', 'íšŒì›ëª…', 'ì¶œì„ì—¬ë¶€', 'ì´ ì¶œì„ì¸ì›', 'ì´ íšŒì›ìˆ˜', 'ì¶œì„ë¥ ']
            ];

            // ëª¨ë“  ë‚ ì§œì™€ íšŒì›ì˜ ì¡°í•© ìƒì„±
            attendanceHistory.forEach(record => {
                const rate = Math.round((record.members.length / record.total) * 100);
                
                // ì¶œì„í•œ íšŒì›ë“¤
                record.members.forEach(member => {
                    attendanceData.push([
                        record.date,
                        member,
                        'O',
                        record.members.length,
                        record.total,
                        rate + '%'
                    ]);
                });
                
                // ë¯¸ì¶œì„ íšŒì›ë“¤ (ì „ì²´ íšŒì› ëª©ë¡ì—ì„œ ì¶œì„ìë¥¼ ì œì™¸)
                const absentMembers = members.filter(m => !record.members.includes(m));
                absentMembers.forEach(member => {
                    attendanceData.push([
                        record.date,
                        member,
                        'X',
                        record.members.length,
                        record.total,
                        rate + '%'
                    ]);
                });
            });

            // ë‚ ì§œë³„ ì¶œì„ í˜„í™© ì‹œíŠ¸ ìƒì„±
            const ws1 = XLSX.utils.aoa_to_sheet(attendanceData);
            
            // ì—´ ë„ˆë¹„ ì„¤ì •
            ws1['!cols'] = [
                { wch: 12 },  // ë‚ ì§œ
                { wch: 15 },  // íšŒì›ëª…
                { wch: 10 },  // ì¶œì„ì—¬ë¶€
                { wch: 12 },  // ì´ ì¶œì„ì¸ì›
                { wch: 12 },  // ì´ íšŒì›ìˆ˜
                { wch: 10 }   // ì¶œì„ë¥ 
            ];

            // ìë™ í•„í„° ì„¤ì • (ì²« ë²ˆì§¸ í–‰)
            ws1['!autofilter'] = { ref: XLSX.utils.encode_range({
                s: { r: 0, c: 0 },
                e: { r: attendanceData.length - 1, c: 5 }
            })};

            XLSX.utils.book_append_sheet(wb, ws1, 'ë‚ ì§œë³„ ì¶œì„ í˜„í™©');

            // 2. íšŒì›ë³„ ì¶œì„ í†µê³„ ì‹œíŠ¸
            const memberStats = {};
            members.forEach(member => {
                memberStats[member] = {
                    total: 0,
                    attended: 0,
                    dates: []
                };
            });

            attendanceHistory.forEach(record => {
                record.members.forEach(member => {
                    if (memberStats[member]) {
                        memberStats[member].attended++;
                        memberStats[member].dates.push(record.date);
                    }
                });
                
                // ì „ì²´ íšŒì›ì˜ total ì¹´ìš´íŠ¸ ì¦ê°€
                Object.keys(memberStats).forEach(member => {
                    memberStats[member].total++;
                });
            });

            const memberData = [
                ['íšŒì›ëª…', 'ì¶œì„ íšŸìˆ˜', 'ì „ì²´ ëª¨ì„ ìˆ˜', 'ì¶œì„ë¥ ', 'ìµœê·¼ ì¶œì„ì¼']
            ];

            Object.keys(memberStats).sort((a, b) => a.localeCompare(b, 'ko')).forEach(member => {
                const stats = memberStats[member];
                const rate = stats.total > 0 
                    ? Math.round((stats.attended / stats.total) * 100) 
                    : 0;
                
                const lastAttendance = stats.dates.length > 0 
                    ? stats.dates.sort().reverse()[0] 
                    : '-';
                
                memberData.push([
                    member,
                    stats.attended,
                    stats.total,
                    rate + '%',
                    lastAttendance
                ]);
            });

            // íšŒì›ë³„ í†µê³„ ì‹œíŠ¸ ìƒì„±
            const ws2 = XLSX.utils.aoa_to_sheet(memberData);
            
            // ì—´ ë„ˆë¹„ ì„¤ì •
            ws2['!cols'] = [
                { wch: 15 },  // íšŒì›ëª…
                { wch: 12 },  // ì¶œì„ íšŸìˆ˜
                { wch: 12 },  // ì „ì²´ ëª¨ì„ ìˆ˜
                { wch: 10 },  // ì¶œì„ë¥ 
                { wch: 15 }   // ìµœê·¼ ì¶œì„ì¼
            ];

            // ìë™ í•„í„° ì„¤ì •
            ws2['!autofilter'] = { ref: XLSX.utils.encode_range({
                s: { r: 0, c: 0 },
                e: { r: memberData.length - 1, c: 4 }
            })};

            XLSX.utils.book_append_sheet(wb, ws2, 'íšŒì›ë³„ í†µê³„');

            // 3. íšŒì›ë³„ ì¶œì„ ìƒì„¸ ë‚´ì—­ ì‹œíŠ¸
            const detailData = [
                ['íšŒì›ëª…', 'ë‚ ì§œ', 'ì¶œì„ì—¬ë¶€']
            ];

            // íšŒì›ë³„ë¡œ ì •ë ¬í•˜ì—¬ ëª¨ë“  ë‚ ì§œì˜ ì¶œì„ ê¸°ë¡ ìƒì„±
            members.sort((a, b) => a.localeCompare(b, 'ko')).forEach(member => {
                attendanceHistory.forEach(record => {
                    const attended = record.members.includes(member) ? 'O' : 'X';
                    detailData.push([
                        member,
                        record.date,
                        attended
                    ]);
                });
            });

            const ws3 = XLSX.utils.aoa_to_sheet(detailData);
            
            // ì—´ ë„ˆë¹„ ì„¤ì •
            ws3['!cols'] = [
                { wch: 15 },  // íšŒì›ëª…
                { wch: 12 },  // ë‚ ì§œ
                { wch: 10 }   // ì¶œì„ì—¬ë¶€
            ];

            // ìë™ í•„í„° ì„¤ì •
            ws3['!autofilter'] = { ref: XLSX.utils.encode_range({
                s: { r: 0, c: 0 },
                e: { r: detailData.length - 1, c: 2 }
            })};

            XLSX.utils.book_append_sheet(wb, ws3, 'íšŒì›ë³„ ì¶œì„ ìƒì„¸');

            // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
            const fileName = `ë§ì½”_ì¶œì„ë¶€_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            showToast('ì—‘ì…€ íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success', 'ğŸ“Š');
        }

        // Enter í‚¤ë¡œ íšŒì› ì¶”ê°€
        document.getElementById('memberNameInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addMember();
            }
        });
    </script>
</body>
</html>